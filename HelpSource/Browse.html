<html>
<head>
    <title>Document Browser</title>
    <link rel='stylesheet' href='./scdoc.css' type='text/css' />
    <meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
    <script src="docmap.js" type="text/javascript"></script>
<style>

.browser {
    margin: 0em;
    border-collapse: collapse;
    margin-top: 1em;
}
.result {
/*    border-left: 1px solid #777;*/
    padding: 2px;
}
.browser td {
    vertical-align: top;
    border: none;
}
.result_doc {
    border-bottom: 1px solid #ddd;
}
.result_summary {
    color: #444;
    font-size: 9pt;
    max-width: 18em;
    margin-bottom: 0.8em;
}
.category, .cat_selected {
    margin-bottom: 0.25em;
/*    padding-left: 10px;*/
    border-bottom: 1px solid transparent;
/*    border-bottom: 1px solid #ddd;*/
/*    margin-right: 1ex;*/
}
.cat_selected {
    border-bottom: 1px solid #777;
}
.category a {
    color: #555;
    font-weight: bold;
}
.cat_selected a {
    color: #000;
    font-weight: bold;
}
.cat_arrow {
    float: right;
    padding-left: 1ex;
    color: #555;
}

#search_checks {
    font-size: 9pt;
    color: #555;
    border-bottom: 1px solid #ddd;
    margin-top: 1em;
    padding-bottom: 1em;
}
</style>

<script type="text/javascript">
var categories = null;
var categorytree = null;
var path = [];
var checkboxes;

function GotoPath(p) {
    path = p.split(">");
    if(window.location.hash != p)
        window.location.hash = p;
    updateTree();
}

function updateTree() {
    var el = document.getElementById("browser");
    var res = "<tr><td>";
    var lev = 0;
    var tree = {entries:[],subcats:categorytree};
    var p;
    var done = 0;
    link = "";
    
    while(1) {
        res += "<div class='result'>";
        p=path[lev++];
        
        var l = [];
        for(var k in tree.subcats)
            l.push(k);
        l = l.sort();
        
        for(var i=0;i<l.length;i++) {
            var k = l[i];
            if(k==p)
                res += "<div class='cat_selected'>";
            else
                res += "<div class='category'>";
            res += "<a href='javascript:GotoPath(\""+link+k+"\")'>"+k+"</a>";
            if(k==p)
                res += "<span class='cat_arrow'> &gt;</span>";
            res += "</div>";
        }

        for(var i=0;i<tree.entries.length;i++) {
            var v = tree.entries[i];
            var x = v.path.split("/");
            
//            var c = checkboxes[x[0].toLowerCase()];
//            if(c && !c.checked)
//                continue;

            res += "<div class='result_doc'><a href='"+v.path+".html'>"+v.title+"</a> <span class='soft'>["+x[0];
            if(v.installed=="extension" || v.installed=="missing")
                res += " : "+v.installed;
            res += "]</span></div><div class='result_summary'>"+v.summary+"</div>";
        }

        res += "</div>";

        if(!p)
            break;
        tree = tree.subcats[p];
        link += p+">";
        res += "<td>";
        if(!tree) {
            res += "<div class='result_summary'>&gt; Category not found: "+p+"</div>";
            break;
        }
    }
    el.innerHTML = res;
}

function buildCategoryTree() {
    var cats = {};
    for(var k in docmap) {
        var v = docmap[k];

        var c = checkboxes[v.path.split("/")[0].toLowerCase()];
        if(c && !c.checked)
            continue;

        var c2 = v.categories.match(/[^, ]+[^,]*[^, ]+/g) || ["Uncategorized"];
        for(var i=0;i<c2.length;i++) {
            var c = c2[i];
            if(!cats[c])
                cats[c]=[];
            cats[c].push(v);
        }
    }
    categories = cats;

    var tree = {};
    var p,l,e,a;
    for(var cat in cats) {
        var files = cats[cat];    

        p=tree;
        l=cat.split(">");

        for(var i=0;i<l.length;i++) {
            var c = l[i];

            if(!p[c]) {
                p[c]={};
                p[c].subcats = {};
                p[c].entries = [];
            }
            e=p[c];
            p=p[c].subcats;
        }

        for(var i=0;i<files.length;i++)
            e.entries.push(files[i]);
            
        e.entries = e.entries.sort(function(a,b) {
            a=a.title; b=b.title;
            if(a<b) return -1;
            else
            if(a>b) return +1;
            else
            return 0;
        });
    }
    
    categorytree = tree;
}

window.onload = function() {
    var fields = ["classes", "reference", "guides", "tutorials", "overviews", "other"];
    checkboxes = {};
    for(var i=0;i<fields.length;i++) {
        var k = fields[i];
        checkboxes[k] = document.getElementById("check_"+k);
        checkboxes[k].onchange = function() {
            buildCategoryTree();
            updateTree();
        };
    }
    buildCategoryTree();
    GotoPath(window.location.hash.slice(1));
}

window.onhashchange = function() {
    GotoPath(window.location.hash.slice(1));
}

</script>

</head>

<body>

<table class='headMenu'>
    <tr><td><a href='./Help.html'>Home</a>
    <td><a href='./Browse.html'>Browse</a>
    <td><a href='./Overviews/Categories.html'>Categories</a>
    <td><a href='./Overviews/Documents.html'>Document index</a>
    <td><a href='./Overviews/Classes.html'>Class index</a>
    <td><a href='./Overviews/Methods.html'>Method index</a>
    <td><a href='./Search.html'>Search</a>
</table>

<div class='header'>
    <div id='label'>SuperCollider</div>
    <h1>Document Browser</h1>
    <div id='summary'>Browse categories</div>
</div>
<div id="search_checks">
Include:
<input type="checkbox" id="check_classes" checked="true">Classes</input>
<input type="checkbox" id="check_reference" checked="true">Reference</input>
<input type="checkbox" id="check_guides" checked="true">Guides</input>
<input type="checkbox" id="check_tutorials" checked="true">Tutorials</input>
<input type="checkbox" id="check_overviews" checked="true">Overviews</input>
<input type="checkbox" id="check_other" checked="true">Other</input>
</div>

<table class="browser" id="browser"></table>

</body>
</html>

