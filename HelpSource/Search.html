<html>
<head>
    <title>Search</title>
    <link rel='stylesheet' href='./scdoc.css' type='text/css' />
    <meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
    <script src="docmap.js" type="text/javascript"></script>
    <script src="methods.js" type="text/javascript"></script>
<style>
div#search_box {
    margin-top: 1em;
    margin-bottom: 0em;
    margin-left: auto;
    margin-right: auto;
/*    width: 75%;*/
    text-align: center;
    font-size: 9pt;
    color: #555;
}
#search_input {
/*    width: 50%;*/
    border: 1px solid #aaa;
    background: #eee;
}
div#search_results {
/*    padding-top: 1em;*/
}
div#search_count {
    border-bottom: 2px solid #aaa;
    color: #333;
}
div.result_item {
    margin-bottom: 0.2em;
}
div.result_category {
    color: #555;
    font-size: 9.5pt;
    margin-top: 1em;
    border-bottom: 1px solid #ccc;
}
div.result_doc {
    margin-left: 2em;
}
div.mets {
    padding-left: 2em;
/*    border-top: 1px solid #eee; */
    margin-bottom: 0.5em;
}
#search_checks {
    margin-left: auto;
    margin-right: auto;
    border-top: 1px solid #ddd;
    margin-top: 1em;
    padding-top: 0.5em;
    font-size: 9pt;
    color: #555;
}
.label {
    color: black;
    font-size: 10pt;
}

</style>

<script type="text/javascript">
var input = "";
var newinput = "";
var checkboxes;
var checkboxes2;
var fields = ["title","summary","categories"];
var fields2 = ["classes", "reference", "guides", "tutorials", "overviews", "other"];
    
window.onload = function() {
    newinput = document.getElementById("search_input").value.toLowerCase();

    checkboxes = [];
    for(var i=0;i<fields.length;i++) {
        checkboxes[i] = document.getElementById("check_"+fields[i]);
        checkboxes[i].onchange = doSearch;
    }
    
    checkboxes2 = {};
    for(var i=0;i<fields2.length;i++) {
        var k = fields2[i];
        checkboxes2[k] = document.getElementById("check_"+k);
        checkboxes2[k].onchange = doSearch;
    }
    document.getElementById("check_filename").onchange = doSearch;
    document.getElementById("check_methods").onchange = doSearch;
    document.getElementById("ignore_case").onchange = doSearch;
    document.getElementById("search_input").focus();
}

function clear1() {
    var x = false;

    for(var i=0;i<checkboxes.length;i++)
        x |= checkboxes[i].checked;
    x |= document.getElementById("check_filename").checked;

    
    for(var i=0;i<checkboxes.length;i++)
        checkboxes[i].checked = !x;
    document.getElementById("check_filename").checked = !x;
    
    doSearch();
}

function clear2() {
    var x = false;

    for(var k in checkboxes2)
        x |= checkboxes2[k].checked;
    x |= document.getElementById("check_methods").checked;

    for(var k in checkboxes2)
        checkboxes2[k].checked = !x;
    document.getElementById("check_methods").checked = !x;

    doSearch();
}

function SearchKeyPressed(e) {
    newinput = e.value.toLowerCase();
    if(newinput != input) {
        document.getElementById("search_results").innerHTML = "Searching...";
//        document.getElementById("search_count").innerHTML = "0 results";
    }
}

function matchDoc(doc,file,folder,re) {
    //FIXME: also search methods? then we need to export the method list as JSON..
    
    var c = checkboxes2[folder.toLowerCase()];
    if(c && !c.checked)
        return false;
    
    for(var i=0;i<fields.length;i++) {
        var f = fields[i];
//        if(checkboxes[i].checked && doc[f] && doc[f].toLowerCase().indexOf(txt)>=0)
        if(checkboxes[i].checked && doc[f] && re.test(doc[f]))
            return true;
    }

//    if(document.getElementById("check_filename").checked && file.toLowerCase().indexOf(txt)>=0)
    if(document.getElementById("check_filename").checked && re.test(file))
        return true;
               
    return false;
}

function doSearch() {
    var res = "";
    var count = 0;

    if(input!="") {
        var cats = {};

        try {        
            var re = RegExp(input,document.getElementById("ignore_case").checked?"i":"");
        } catch(err) {
            document.getElementById("search_count").innerHTML = "Invalid regexp";
            document.getElementById("search_results").innerHTML = err;
            return;
        }
        
        for(var k in docmap) {
            var v = docmap[k];
            var x = k.split("/");
            var folder = x[0];
            var file = x[x.length-1];

            if(matchDoc(v,file,folder,re)) {
            
//                var c2 = v.categories.match(/[^, ]+[^,]*[^, ]+/g) || ["Uncategorized"];
//                for(var i=0;i<c2.length;i++) {
//                    var c = c2[i];
                    var c = v.categories;
                    if(!cats[c])
                        cats[c]=[];
                    cats[c].push(v);
//                }

                count++;
            }
        }

        for(k in cats) {
            var c = cats[k];
            res += "<div class='result_category'>"+k+"</div>";
            for(var i=0;i<c.length;i++) {
                var v = c[i];
                var x = v.path.split("/");
                res += "<div class='result_item'>";
                res += "<div class='result_doc'><a href='"+v.path+".html'>"+v.title+"</a> - "+v.summary+" <span class='soft'>["+x[0];
                
                if(v.installed=="extension")
                    res += " +";
                else if(v.installed=="missing")
                    res += " - missing!";

                res += "]</span></div></div>";
            }
        }

        if(document.getElementById("check_methods").checked) {
            var mets = {};
            var found = false;
            for(k in methods) {
                if(re.test(k)) {
                    mets[k] = methods[k];
                    found = true;
                    count++;
                }
            }

            if(found) {
                res += "<div class='result_category'>Methods</div>";
                for(k in mets) {
                    res += "<div class='result_item'>";
                    res += "<div class='result_doc'>"+k+"<div class='mets'>";
                    var x = mets[k];
                    for(var i=0;i<x.length;i++) {
                        var m = x[i];
                        if(i!=0) res += ", ";
                        res += "<a href='Classes/"+m+".html#"+k+"'>"+m+"</a>";
                    }
                    res += "</div></div></div>";
                }
            }
        }
    }
    document.getElementById("search_count").innerHTML = count+" results";
    document.getElementById("search_results").innerHTML = res;
}

function showReHelp() {
    window.open("RegExHelp.html","regexhelp","width=450,height=300");
}

function delayed_update() {
    if(input != newinput) {
        input = newinput;
        doSearch();
    }
}
setInterval("delayed_update()",1000);

</script>

</head>

<body>

<table class='headMenu'>
    <tr><td><a href='./Help.html'>Home</a>
    <td><a href='./Browse.html'>Browse</a>
    <td><a href='./Overviews/Categories.html'>Categories</a>
    <td><a href='./Overviews/Documents.html'>Document index</a>
    <td><a href='./Overviews/Classes.html'>Class index</a>
    <td><a href='./Overviews/Methods.html'>Method index</a>
    <td><a href='./Search.html'>Search</a>
</table>

<div class='header'>
    <div id='label'>SuperCollider</div>
    <h1>Search</h1>
    <div id='summary'>Search all documents</div>
</div>

<div id="search_box">
<span class="label">Search (<a href="javascript:showReHelp()">regex</a>):</span> <input type="text" id="search_input" value="" size="40" onkeyup="SearchKeyPressed(this)"/>
<input type="checkbox" id="ignore_case" checked="true">Ignore case</input>
<div id="search_checks">
<span class="label">Search in:</span>
<input type="checkbox" id="check_title" checked="true">Title/Class</input>
<input type="checkbox" id="check_summary" checked="true">Summary</input>
<input type="checkbox" id="check_categories" checked="true">Categories</input>
<input type="checkbox" id="check_filename" checked="true">Filename</input>
&nbsp;&larr; <a href="javascript:clear1()">clear all</a>
<br>
<span class="label">Include:</span>
<input type="checkbox" id="check_classes" checked="true">Classes</input>
<input type="checkbox" id="check_reference" checked="true">Reference</input>
<input type="checkbox" id="check_guides" checked="true">Guides</input>
<input type="checkbox" id="check_tutorials" checked="true">Tutorials</input>
<input type="checkbox" id="check_overviews" checked="true">Overviews</input>
<input type="checkbox" id="check_other" checked="true">Other</input>
<input type="checkbox" id="check_methods" checked="true">Methods</input>
&nbsp;&larr; <a href="javascript:clear2()">clear all</a>
</div>
</div>

<div id="search_count">0 results</div>
<div id="search_results"></div>

</body>
</html>

